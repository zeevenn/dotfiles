#!/bin/bash
# Usage: ide [path]
# Default: use current directory
#
#  Two windows layout:
#
#  Window 1 (code):
#  ┌──────────────────────┐
#  │                      │
#  │        Code          │  <- vim
#  │                      │
#  └──────────────────────┘
#
#  Window 2 (shell):
#  ┌──────────────────────┐
#  │                      │
#  │       Shell          │
#  │                      │
#  └──────────────────────┘
#

DIR=${1:-$(pwd)}
SESSION=$(basename "$DIR" | tr . _)

# Check if session exists using exact match
if tmux list-sessions -F '#{session_name}' 2>/dev/null | grep -q "^${SESSION}$"; then
  SESSION_EXISTS=true
else
  SESSION_EXISTS=false
fi

# If session doesn't exist, create it
if [ "$SESSION_EXISTS" = "false" ]; then
  # Create new session with first window (code)
  tmux new-session -d -s "$SESSION" -c "$DIR" -n code

  # Select code pane and start vim
  tmux select-pane -t "$SESSION":1.1
  tmux send-keys -t "$SESSION":1.1 "vi ." C-m

  # Create second window (shell)
  tmux new-window -t "$SESSION":2 -n shell -c "$DIR"

  # Switch back to first window
  tmux select-window -t "$SESSION":1
fi

# Attach or switch to session
if [ -n "$TMUX" ]; then
  # Already in tmux, switch to the session
  tmux switch-client -t "$SESSION"
else
  # Not in tmux, attach to the session
  tmux attach -t "$SESSION"
fi
